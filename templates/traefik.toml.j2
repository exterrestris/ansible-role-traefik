# {{ ansible_managed }}

## Static configuration
[entryPoints]
{% for entrypoint, config in traefik_entry_points.items() %}
  [entryPoints.{{ entrypoint }}]
{% if config is mapping %}
    address = "{{ config.ip | default('') }}:{{ config.port }}{% if config.protocol is defined %}/{{ config.protocol  }}{% endif %}"
{% if config.http is defined %}
    [entryPoints.{{ entrypoint }}.http]
{% if config.http.redirect is defined %}
      [entryPoints.{{ entrypoint }}.http.redirections]
        [entryPoints.{{ entrypoint }}.http.redirections.entryPoint]
          to = "{{ config.http.redirect.to }}"
{% endif %}
{% endif %}
{% else %}
    address = ":{{ config }}"
{% endif %}
{% endfor %}

[api]
  insecure = {{ 'true' if traefik_insecure_api else 'false' }}
  dashboard = {{ 'true' if traefik_dashboard else 'false' }}

{% if traefik_providers.items() | length > 0 %}
[providers]
{% for provider, config in traefik_providers.items() %}
  [providers.{{ provider }}]
{% for property, value in config.items() %}
{% if value is boolean %}
    {{ property }} = {{ value | lower }}
{% else %}
    {{ property }} = "{{ value }}"
{% endif %}
{% endfor %}
{% endfor %}
{% endif %}